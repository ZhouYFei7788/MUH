<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>加湿除湿量计算工具</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 8px;
    padding: 0;
    box-sizing: border-box;
    color: #333;
  }
  h2 {
    text-align: center;
    margin-bottom: 12px;
    font-size: 1.3rem;
  }
  .input-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding-bottom: 5px;
  }
  label {
    white-space: nowrap;
    display: flex;
    align-items: center;
    font-size: 0.85rem;
    min-width: 80px;
    flex: 1 1 45%;
  }
  input[type=number] {
    width: 55px;
    padding: 4px 5px;
    font-size: 0.85rem;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-left: 5px;
    box-sizing: border-box;
    text-align: right;
  }
  button {
    width: 100%;
    padding: 8px 0;
    margin: 8px 0;
    font-size: 0.95rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    color: white;
  }
  button.calculate {
    background-color: #3399ff;
  }
  button.clear {
    background-color: #d9534f;
  }
  .result {
    margin-top: 15px;
    font-weight: 600;
    font-size: 1rem;
    min-height: 40px;
    text-align: left;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    font-size: 0.8rem;
  }
  th, td {
    border: 1px solid #aaa;
    padding: 5px 6px;
    text-align: left;
    vertical-align: top;
  }
  th {
    background-color: #f5f5f5;
  }
  @media (max-width: 480px) {
    label {
      flex: 1 1 100%;
    }
    input[type=number] {
      width: 50px;
      font-size: 0.8rem;
    }
    button {
      font-size: 1rem;
    }
    table {
      font-size: 0.75rem;
    }
    th, td {
      padding: 4px 5px;
    }
  }
</style>
</head>
<body>

<h2>加湿除湿量计算工具</h2>

<div class="input-row" aria-label="一次性输入参数1">
  <label for="altitude">海拔(m)
    <input type="number" id="altitude" />
  </label>
  <label for="area">风口面积(m²)
    <input type="number" id="area" step="0.01" />
  </label>
</div>

<div class="input-row" aria-label="一次性输入参数2">
  <label for="density">空气密度(kg/m³)
    <input type="number" id="density" step="0.01" />
  </label>
  <label for="supply_temp">送风温度(°C)
    <input type="number" id="supply_temp" step="0.1" />
  </label>
</div>

<div class="input-row" aria-label="送风与回风数据1">
  <label for="supply_rh">送风湿度(%)
    <input type="number" id="supply_rh" step="0.1" />
  </label>
  <label for="return_temp">回风温度(°C)
    <input type="number" id="return_temp" step="0.1" />
  </label>
</div>

<div class="input-row" aria-label="回风与风速数据">
  <label for="return_rh">回风湿度(%)
    <input type="number" id="return_rh" step="0.1" />
  </label>
  <label for="velocity">风速(m/s)
    <input type="number" id="velocity" step="0.01" />
  </label>
</div>

<div>
  <button class="calculate" onclick="calculate()">计算</button>
  <button class="clear" onclick="clearInputs()">清除送回风与风速数据</button>
</div>

<div class="result" id="result"></div>

<table id="recordTable">
  <thead>
    <tr>
      <th>公式与结果</th>
      <th>参数记录</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  function calcMixingRatio(altitude, temp, rh) {
    const P0 = 101.325;
    const L = 0.0065;
    const T0 = 288.15;
    const g = 9.80665;
    const M = 0.0289644;
    const R = 8.31447;

    let tempFactor = 1 - (L * altitude) / T0;
    let expFactor = (g * M) / (R * L);
    let pressure = P0 * Math.pow(tempFactor, expFactor);

    let Ps = 0.61078 * Math.exp((17.27 * temp) / (temp + 237.3));
    let Pv = (rh / 100) * Ps;
    let W = 0.622 * Pv / (pressure - Pv);

    return W * 1000;
  }

  function calculate() {
    let altitude = parseFloat(document.getElementById("altitude").value);
    let area = parseFloat(document.getElementById("area").value);
    let density = parseFloat(document.getElementById("density").value);

    let supply_temp = parseFloat(document.getElementById("supply_temp").value);
    let supply_rh = parseFloat(document.getElementById("supply_rh").value);

    let return_temp = parseFloat(document.getElementById("return_temp").value);
    let return_rh = parseFloat(document.getElementById("return_rh").value);

    let velocity = parseFloat(document.getElementById("velocity").value);

    if (isNaN(supply_temp) || isNaN(supply_rh) || isNaN(return_temp) || isNaN(return_rh) || isNaN(velocity)) {
      alert("请完整填写送回风与风速数据！");
      return;
    }
    if (isNaN(altitude) || isNaN(area) || isNaN(density)) {
      alert("请填写一次性输入参数！");
      return;
    }

    let supply_w = calcMixingRatio(altitude, supply_temp, supply_rh);
    let return_w = calcMixingRatio(altitude, return_temp, return_rh);

    let volume_flow = area * velocity;
    let volume_flow_hour = volume_flow * 3600;
    let diff = return_w - supply_w;
    let resultValue = (density * diff * volume_flow_hour / 1000).toFixed(2);

    let resultText = `送风含水量：${supply_w.toFixed(2)} g/kg<br>回风含水量：${return_w.toFixed(2)} g/kg<br>`;

    let formulaText = `[${density.toFixed(3)} * (${return_w.toFixed(2)} - ${supply_w.toFixed(2)}) * ${volume_flow_hour.toFixed(2)}] / 1000 = ${resultValue} kg/h`;

    let statusText = diff > 0 ? '除湿' : (diff < 0 ? '加湿' : '无变化');

    document.getElementById("result").innerHTML = resultText + statusText;

    let paramSummary = `送:${supply_temp}°C/${supply_rh}% 回:${return_temp}°C/${return_rh}% 风速:${velocity}m/s`;

    let table = document.getElementById("recordTable").getElementsByTagName('tbody')[0];
    let newRow = table.insertRow();

    newRow.insertCell(0).innerHTML = formulaText + ` (${statusText})`;
    newRow.insertCell(1).innerHTML = paramSummary;
  }

  function clearInputs() {
    document.getElementById("supply_temp").value = '';
    document.getElementById("supply_rh").value = '';
    document.getElementById("return_temp").value = '';
    document.getElementById("return_rh").value = '';
    document.getElementById("velocity").value = '';
    document.getElementById("result").innerHTML = '';
  }
</script>

</body>
</html>
